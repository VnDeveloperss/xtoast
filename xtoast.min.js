class XToast{constructor(){this.containers=new Map,this.toastInstances=new Map,this.plugins=new Map,this.templates=new Map,this.state=new Map,this.toastHistory=[],this.offlineQueue=[],this.abTests=new Map,this.featureFlags=new Map,this.easterEggs=new Map,this.performanceMetrics={renderTime:0,memoryUsage:0},this.defaultOptions={duration:4e3,position:"top-center",radius:"rounded-2xl",type:"info"},this.config={version:"4.0.0",silentMode:!1,maxToasts:8,enableAI:!1,security:{maxToastsPerMinute:120,allowedDomains:["*"],contentFilters:[],encryptSensitive:!1},performance:{virtualization:!0,lazyLoad:!0,compression:!0},animations:{enter:"translate-y-[-150%] opacity-0",leave:"translate-y-[-150%] opacity-0",duration:500},responsive:{mobile:"bottom-center",tablet:"top-right",desktop:"top-right",breakpoints:{mobile:768,tablet:1024}},integrations:{analytics:null,crm:null,helpdesk:null},ai:{optimizePosition:!0,predictDismiss:!0,personalizeContent:!0}},this.allowedPositions=["top-center","top-left","top-right","bottom-center","bottom-left","bottom-right"],this.allowedRadius=["rounded-none","rounded-lg","rounded-xl","rounded-2xl","rounded-3xl","rounded-full"],this.icons={success:"text-emerald-400",error:"text-red-400",warning:"text-amber-400",info:"text-blue-400",loading:"text-purple-400"},this.ringColors={success:"stroke-emerald-400",error:"stroke-red-400",warning:"stroke-amber-400",info:"stroke-blue-400",loading:"stroke-purple-400"},this.init()}init(){this.loadConfig(),this.initContainers(),this.setupEventListeners(),this.loadPlugins(),this.initAI(),this.config.silentMode||this.checkForUpdates()}loadConfig(){const t=window.XTOAST_CONFIG||{};this.config={...this.config,...t}}initContainers(){this.allowedPositions.forEach(t=>{const e=`xtoast-${t.replace("-","")}`;let s=document.getElementById(e);s||(s=document.createElement("div"),s.id=e,s.className=this.getContainerClass(t),s.setAttribute("data-xtoast-container","true"),document.body.appendChild(s)),this.containers.set(t,s)})}getContainerClass(t){const e={"top-center":"fixed inset-x-0 top-4 z-[9999] flex flex-col items-center gap-3 px-4 pointer-events-none","top-left":"fixed top-4 left-4 z-[9999] flex flex-col items-start gap-3 pointer-events-none","top-right":"fixed top-4 right-4 z-[9999] flex flex-col items-end gap-3 pointer-events-none","bottom-center":"fixed inset-x-0 bottom-4 z-[9999] flex flex-col items-center gap-3 px-4 pointer-events-none","bottom-left":"fixed bottom-4 left-4 z-[9999] flex flex-col items-start gap-3 pointer-events-none","bottom-right":"fixed bottom-4 right-4 z-[9999] flex flex-col items-end gap-3 pointer-events-none"};return e[t]||e["top-center"]}setupEventListeners(){let t;window.addEventListener("online",()=>this.processOfflineQueue()),window.addEventListener("offline",()=>{this.isOnline=!1}),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.currentBreakpoint=this.getCurrentBreakpoint()},250)})}loadPlugins(){this.plugins.forEach(t=>{t.onInit&&t.onInit()})}initAI(){this.config.enableAI&&this.setupAIOptimization()}setupAIOptimization(){console.log("OtimizaÃ§Ã£o por IA ativada")}checkForUpdates(){const t=localStorage.getItem("xtoast-version");this.config.version!==t&&(setTimeout(()=>{this.create({message:`XToast atualizado para v${this.config.version}`,type:"info",position:"top-right",duration:5e3})},1e3),localStorage.setItem("xtoast-version",this.config.version))}getCurrentBreakpoint(){if("undefined"==typeof window)return"desktop";const t=window.innerWidth,e=this.config.responsive.breakpoints;return t<e.mobile?"mobile":t<e.tablet?"tablet":"desktop"}getResponsivePosition(t){const e=this.currentBreakpoint||this.getCurrentBreakpoint(),s=this.config.responsive[e];return this.allowedPositions.includes(s)?s:t}parseArguments(t,e,s,i={}){const o={message:t};return"string"==typeof e&&this.allowedPositions.includes(e)?o.position=e:"number"==typeof e?(o.duration=e,o.position=this.defaultOptions.position):o.position=this.defaultOptions.position,"number"==typeof s?o.duration=s:"string"==typeof s&&this.allowedPositions.includes(s)&&(o.position=s),{...o,...i}}validateOptions(t){const e={...this.defaultOptions,...t};return this.allowedPositions.includes(e.position)||(e.position=this.defaultOptions.position),this.allowedRadius.includes(e.radius)||(e.radius=this.defaultOptions.radius),e.duration=Math.max(0,parseInt(e.duration)||this.defaultOptions.duration),e}sanitizeHTML(t){if("string"!=typeof t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}generateUniqueId(){return"xtoast-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}getIconSVG(t){const e={success:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m17 15-5.5 5.5L9 18"/><path d="M5 17.743A7 7 0 1 1 15.71 10h1.79a4.5 4.5 0 0 1 1.5 8.742"/></svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',loading:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>'};return e[t]||e.info}createProgressRing(t,e){const s=2*Math.PI*20,i=this.ringColors[e];return"loading"===e||0===t?'<svg class="w-12 h-12" aria-hidden="true"><circle cx="24" cy="24" r="20" stroke="#1f2937" stroke-width="7" fill="none"/></svg>':`\n            <svg class="w-12 h-12 -rotate-90" aria-hidden="true">\n                <circle cx="24" cy="24" r="20" stroke="#1f2937" stroke-width="7" fill="none"/>\n                <circle cx="24" cy="24" r="20" stroke="" class="${i} progress-ring" stroke-width="5" stroke-linecap="round"\n                    fill="none" stroke-dasharray="${s}" stroke-dashoffset="${s}">\n                    <animate attributeName="stroke-dashoffset" from="${s}" to="0" dur="${t}ms" fill="freeze"/>\n                </circle>\n            </svg>\n        `}createActionButtons(t,e){return t&&Array.isArray(t)&&0!==t.length?`\n            <div class="flex gap-2 mt-3">\n                ${t.map((t,s)=>`\n                    <button\n                        class="px-3 py-1.5 text-xs font-medium rounded-lg border border-white/20 hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-white/50"\n                        onclick="window.handleXToastAction('${e}', ${s})"\n                        type="button"\n                    >\n                        ${t.text}\n                    </button>\n                `).join("")}\n            </div>\n        `:""}createProgressBar(t,e){if(void 0===t)return"";return`\n            <div class="w-full mt-3">\n                <div class="w-full bg-white/20 rounded-full h-2">\n                    <div\n                        class="bg-emerald-400 h-2 rounded-full transition-all duration-300 progress-bar"\n                        style="width: ${t}%"\n                        data-toast-id="${e}"\n                    ></div>\n                </div>\n                ${`\n            <div class="text-xs text-white/70 mt-1 text-right">${t}%</div>\n        `}\n            </div>\n        `}createRichMedia(t){if(!t)return"";let e="";const s=t.avatar,i=t.image,o=t.title,n=t.subtitle;return(s||i)&&(e+='<div class="flex items-start gap-3 mb-2">',s&&(e+=`<img src="${t.avatar}" class="w-10 h-10 rounded-full flex-shrink-0" alt="Avatar">`),e+='<div class="flex-1 min-w-0">',o&&(e+=`<div class="font-semibold text-sm text-white">${t.title}</div>`),n&&(e+=`<div class="text-xs text-white/70 mt-1">${t.subtitle}</div>`),e+="</div>",i&&!s&&(e+=`<img src="${t.image}" class="w-12 h-12 rounded-lg object-cover flex-shrink-0" alt="Preview">`),e+="</div>"),e}create(t){if(this.config.silentMode&&"error"!==t.type)return{remove:()=>{},updateProgress:()=>{},morph:()=>{}};const e="string"==typeof t?{message:t}:t,s=this.validateOptions(e),i={...s,position:this.getResponsivePosition(s.position),message:this.config.security.sanitizeHTML?this.sanitizeHTML(s.message||""):s.message},o=this.containers.get(i.position);if(!o)return{remove:()=>{},updateProgress:()=>{},morph:()=>{}};const n=document.createElement("div"),r=this.generateUniqueId(),a=this.createActionButtons(i.actions,r),l=this.createProgressBar(i.progress,r),c=this.createRichMedia(i.richMedia);n.id=r,n._actions=i.actions;const d=this.config.animations.enter;n.className=`pointer-events-auto relative bg-gray-900/95 backdrop-blur-xl border border-white/10 ${i.radius} shadow-2xl overflow-hidden w-full max-w-sm p-4 text-white cursor-pointer transform ${d} transition-all duration-500`,n.setAttribute("data-xtoast-element","true"),n.setAttribute("data-position",i.position);const h=i.richMedia&&(i.richMedia.avatar||i.richMedia.image);let u;n.innerHTML=`\n            <div class="flex items-start gap-3 w-full">\n                <div class="relative flex-shrink-0">\n                    ${this.createProgressRing(i.duration,i.type)}\n                    <div class="absolute inset-0 flex items-center justify-center ${this.icons[i.type]}" aria-hidden="true">\n                        ${this.getIconSVG(i.type)}\n                    </div>\n                </div>\n\n                <div class="flex-1 min-w-0">\n                    ${h?c:""}\n\n                    <div class="text-sm font-medium ${h?"mt-2":""}">${i.message}</div>\n\n                    ${l}\n                    ${a}\n                </div>\n\n                <button class="flex-shrink-0 w-5 h-5 opacity-50 hover:opacity-100 transition-opacity mt-1"\n                        aria-label="Fechar notificaÃ§Ã£o"\n                        onclick="window.xtoast.handleClose('${r}')">\n                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">\n                        <path d="M12 4L4 12M4 4l8 8"/>\n                    </svg>\n                </button>\n            </div>\n        `,o.appendChild(n),requestAnimationFrame(()=>{document.body.contains(n)&&(n.classList.remove(...d.split(" ")),n.classList.add("translate-y-0","opacity-100"))}),this.toastHistory.push({id:r,type:i.type,message:i.message,position:i.position,timestamp:Date.now()}),this.toastHistory.length>100&&this.toastHistory.shift();const p=performance.now();i.duration>0&&"loading"!==i.type&&(u=setTimeout(()=>{document.body.contains(n)&&this.removeToast(n)},i.duration));const g=()=>{"loading"!==i.type&&clearTimeout(u)},m=()=>{if(i.duration>0&&"loading"!==i.type&&document.body.contains(n)){const t=performance.now()-p,e=i.duration-t;e>0&&(u=setTimeout(()=>{document.body.contains(n)&&this.removeToast(n)},e))}};return"loading"!==i.type&&(n.addEventListener("mouseenter",g),n.addEventListener("mouseleave",m)),this.triggerPluginHook("toastCreated",{toast:n,options:i}),{remove:()=>{document.body.contains(n)&&this.removeToast(n)},updateProgress:t=>{this.updateProgress(r,t)},morph:t=>{this.morphToast(r,t)},id:r}}removeToast(t){if(!t||!document.body.contains(t))return;t.classList.replace("translate-y-0","translate-y-[-150%]"),t.classList.replace("opacity-100","opacity-0");const e=()=>{document.body.contains(t)&&(t.remove(),this.triggerPluginHook("toastRemoved",{toast:t}))};t.addEventListener("transitionend",e,{once:!0}),setTimeout(e,1e3)}updateProgress(t,e){const s=document.getElementById(t);if(!s)return;const i=s.querySelector(".progress-bar"),o=s.querySelector(".text-xs");i&&(i.style.width=`${e}%`),o&&(o.textContent=`${e}%`),e>=100&&setTimeout(()=>this.removeToast(s),1e3)}morphToast(t,e){const s=document.getElementById(t);s&&(this.removeToast(s),setTimeout(()=>{this.create(e)},300))}handleClose(t){const e=document.getElementById(t);e&&this.removeToast(e)}handleAction(t,e){const s=document.getElementById(t);if(!s)return;const i=s._actions?.[e];i&&i.onClick&&i.onClick(),!1!==i?.dismiss&&this.removeToast(s)}triggerPluginHook(t,e){this.plugins.forEach(s=>{s[t]&&s[t](e)})}processOfflineQueue(){for(;this.offlineQueue.length>0;){const t=this.offlineQueue.shift();this.create(t)}}setState(t,e){this.state.set(t,e),this.triggerPluginHook("stateChanged",{key:t,value:e})}getState(t){return this.state.get(t)}navigation(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,actions:[...o.actions||[],{text:o.routeText||"Abrir",onClick:()=>{o.onNavigate?o.onNavigate(o.route,o.params):o.route&&(window.location.href=o.route)}}]})}createInstance(t,e={}){const s={config:{...this.config,...e},create:e=>this.create({...e,_instance:t})};return this.toastInstances.set(t,s),s}conditional(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return i.conditions&&!this.checkConditions(i.conditions)?{remove:()=>{},updateProgress:()=>{},morph:()=>{}}:this.create(o)}checkConditions(t){return!0}registerTemplate(t,e){this.templates.set(t,e)}useTemplate(t,e={}){const s=this.templates.get(t);if(!s)return null;let i=s.message;return Object.keys(e).forEach(t=>{i=i.replace(`{${t}}`,e[t])}),this.create({...s,message:i,...e})}carousel(t,e,s,i={}){const o=`carousel-${Date.now()}`;const n=r=>{const a=t[r];this.create({...i,...a,position:e,duration:s,_carousel:o,actions:[...a.actions||[],{text:"PrÃ³ximo",onClick:()=>n((r+1)%t.length)}]})};return n(0),o}showMiniMap(){const t=document.createElement("div");t.className="fixed bottom-4 left-4 z-[10000] bg-gray-900/90 p-4 rounded-lg backdrop-blur-xl border border-white/10",t.innerHTML='<h3 class="text-white font-semibold mb-2 text-sm">Toasts Ativos</h3>',this.containers.forEach((e,s)=>{const i=e.querySelectorAll("[data-xtoast-element]");if(i.length>0){const e=document.createElement("div");e.className="text-white text-xs mb-1",e.textContent=`${s}: ${i.length}`,t.appendChild(e)}}),document.body.appendChild(t),setTimeout(()=>t.remove(),5e3)}celebration(t,e,s,i={}){navigator.vibrate&&navigator.vibrate([100,50,100]);const o=this.parseArguments(`${t} ðŸŽ‰`,e,s,i);return this.create({...o,type:"success",duration:5e3})}rich(t,e,s,i,o={}){const n=this.parseArguments(t,s,i,o);return this.create({...n,richMedia:e})}payment(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"success",actions:[...o.actions||[],{text:"Recibo",onClick:()=>console.log("Mostrar recibo")}]})}helpdesk(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"info",actions:[...o.actions||[],{text:"Ver Ticket",onClick:()=>console.log("Abrir ticket")}]})}registerPlugin(t,e){this.plugins.set(t,e)}enableVoiceCommands(t){console.log("Comandos de voz ativados:",t)}enableGestureControls(t){console.log("Controles por gesto ativados:",t)}enableGDPRMode(){this.config.security.gdprCompliant=!0}triggerHaptic(t){navigator.vibrate&&navigator.vibrate(t)}registerEasterEgg(t,e,s){this.easterEggs.set(t,{sequence:e,action:s})}show(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create(o)}success(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"success"})}error(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"error"})}warning(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"warning"})}info(t,e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"info"})}loading(t="Carregando...",e,s,i={}){const o=this.parseArguments(t,e,s,i);return this.create({...o,type:"loading",duration:0})}destroy(){this.containers.forEach(t=>{t.querySelectorAll("[data-xtoast-element]").forEach(t=>t.remove())})}}window.xtoast||(window.xtoast=new XToast,window.handleXToastAction=(t,e)=>{window.xtoast.handleAction(t,e)},window.handleXToastClose=t=>{window.xtoast.handleClose(t)}),"undefined"!=typeof module&&module.exports&&(module.exports=XToast);